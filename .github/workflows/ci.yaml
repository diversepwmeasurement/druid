jobs:
  test:
    name: Test JDK ${{ matrix.java }}, ${{ matrix.os }}
    runs-on: self-hosted
    steps:
    - continue-on-error: true
      uses: actions/checkout@v4
    - continue-on-error: true
      name: Set up JDK
      uses: actions/setup-java@v4
      with:
        cache: maven
        distribution: temurin
        java-version: ${{ matrix.java }}
    - continue-on-error: true
      if: ${{ matrix.java == '8' || matrix.java == '11'}}
      name: Build with Maven if test jdk8
      run: ./mvnw -Pgen-javadoc clean package -B
    - continue-on-error: true
      if: ${{ matrix.java == '17' || matrix.java == '21' }}
      name: Build with Maven if test jdk17
      run: ./mvnw -Penable-for-jdk17+,gen-code-cov clean package -B
    - continue-on-error: true
      if: ${{ matrix.java == '17' }}
      name: Codecov if test jdk17
      uses: codecov/codecov-action@v3.1.0
      with:
        files: ./core/target/site/jacoco/jacoco.xml,./druid-spring-boot-starter/target/site/jacoco/jacoco.xml,./druid-spring-boot-3-starter/target/site/jacoco/jacoco.xml
    strategy:
      fail-fast: false
      matrix:
        java:
        - 8
        - 11
        - 17
        - 21
        os:
        - ubuntu-latest
      max-parallel: 16
name: Java CI
on:
  repository_dispatch:
    types: trigger-ga___ci.yaml
